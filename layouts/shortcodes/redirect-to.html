{{- /* 获取参数 */ -}}
{{- $url := .Get "url" | default "" -}}
{{- $delay := .Get "delay" | default 3 -}}
{{- $text := .Get "text" | default "如果您没有自动跳转，请点击这里" -}}

{{- if $url -}}
    <div id="redirect-message-{{ .Ordinal }}" style="text-align: center; padding: 2rem; border: 1px solid #eee; border-radius: 8px; margin: 1rem 0;">
        <!-- 添加旋转动画的样式 -->
        <style>
            #redirect-message-{{ .Ordinal }} .spinner {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #3498db;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin-{{ .Ordinal }} 1s linear infinite;
                margin: 20px auto;
            }
            @keyframes spin-{{ .Ordinal }} {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>
        
        <!-- 旋转圈圈 -->
        <div class="spinner"></div>
        
        <h3>跳转提示</h3>
        <p><span id="countdown-{{ .Ordinal }}">{{ $delay }}</span> 秒后即将跳转到新页面...</p>
        <p><a href="{{ $url }}" id="manual-redirect-{{ .Ordinal }}">{{ $text }}</a></p>
        
        <script>
            (function() {
                var targetUrl = "{{ $url | safeJS }}";
                var countdownEl = document.getElementById('countdown-{{ .Ordinal }}');
                var manualLink = document.getElementById('manual-redirect-{{ .Ordinal }}');
                var delay = {{ $delay }};
                
                // 更新手动链接的文本显示URL
                manualLink.textContent = manualLink.textContent + " (" + targetUrl + ")";
                
                // 倒计时函数
                var countdown = setInterval(function() {
                    delay--;
                    countdownEl.textContent = delay;
                    
                    if (delay <= 0) {
                        clearInterval(countdown);
                        window.location.href = targetUrl;
                    }
                }, 1000);
            })();
        </script>
    </div>
{{- else -}}
    <div style="color: red; padding: 1rem; background: #ffeeee; border: 1px solid red;">
        <strong>错误：</strong> redirect-to shortcode 必须提供 'url' 参数。示例：{{ "{{< redirect-to url=\"https://example.com\" >}}" }}
    </div>
{{- end -}}